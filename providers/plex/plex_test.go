package plexprovider

import (
	"github.com/stretchr/testify/assert"
	"testing"
)

const testData = "<!DOCTYPE html>\n<html lang=\"en\">\n\t<head>\n\t\t<meta charset=\"utf-8\" />\n\t\t<link rel=\"icon\" href=\"../favicon.png\" />\n\t\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n\t\t\n\t\t<link href=\"../_app/immutable/assets/0.7DCu-3rm.css\" rel=\"stylesheet\">\n\t\t<link href=\"../_app/immutable/assets/2.Zp_VnBpT.css\" rel=\"stylesheet\">\n\t\t<link href=\"../_app/immutable/assets/4.d9ZCyRYK.css\" rel=\"stylesheet\"><title>Golden Fortress | Dandara</title><!-- HEAD_svelte-16h5gbr_START --><link rel=\"canonical\" href=\"https://listen.plex.tv/track/5d0801f5403c640290ebb73b\"><meta name=\"description\" content=\"\"><meta name=\"apple-itunes-app\" content=\"app-id=1500797510\"><meta property=\"og:title\" content=\"Golden Fortress\"><meta property=\"og:url\" content=\"https://listen.plex.tv/track/5d0801f5403c640290ebb73b?\"><meta property=\"og:image\" content=\"https://images.plex.tv/photo?blur=0&amp;crop=center&amp;size=large-1280&amp;opacity=100&amp;url=https%3A%2F%2Flastfm.freetls.fastly.net%2Fi%2Fu%2F300x300%2Ff24fc3dff2ad496e03f8ec94383ff7de.jpg&amp;quality=80\"><meta property=\"og:site_name\" content=\"Plex\"><meta property=\"og:type\" content=\"music.song\"> <meta property=\"music:musician\" content=\"https://listen.plex.tv/artist/5d07bfaa403c6402907820eb\"> <meta property=\"music:album\" content=\"https://listen.plex.tv/artist/5d07cbdc403c640290e2ab2e\"> <meta property=\"music:release_date\"> <meta property=\"og:description\" content=\"Golden Fortress, a track by Thommaz Kauffmann on Plex\"><link rel=\"preload\" as=\"image\" href=\"https://images.plex.tv/photo?blur=75&amp;crop=center&amp;size=medium-360&amp;opacity=100&amp;url=https%3A%2F%2Flastfm.freetls.fastly.net%2Fi%2Fu%2F300x300%2Ff24fc3dff2ad496e03f8ec94383ff7de.jpg&amp;quality=30\"><link rel=\"preload\" as=\"image\" href=\"https://images.plex.tv/photo?blur=0&amp;crop=center&amp;size=large-1280&amp;opacity=100&amp;url=https%3A%2F%2Flastfm.freetls.fastly.net%2Fi%2Fu%2F300x300%2Ff24fc3dff2ad496e03f8ec94383ff7de.jpg&amp;quality=80\"><meta name=\"twitter:card\" content=\"summary_large_image\"><meta name=\"twitter:creater\" content=\"@plexamp\"><meta name=\"twitter:site\" content=\"@plexamp\"><!-- HEAD_svelte-16h5gbr_END -->\n\t</head>\n\t<body data-sveltekit-preload-data=\"hover\">\n\t\t<div>   <div class=\"bg svelte-97fxgh\" style=\"background-image: linear-gradient(to right, rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url(https://images.plex.tv/photo?blur=75&amp;crop=center&amp;size=medium-360&amp;opacity=100&amp;url=https%3A%2F%2Flastfm.freetls.fastly.net%2Fi%2Fu%2F300x300%2Ff24fc3dff2ad496e03f8ec94383ff7de.jpg&amp;quality=30);\"><div></div> <div class=\"bg-child content svelte-97fxgh\"><img width=\"80\" height=\"37\" class=\"plex-logo svelte-97fxgh\" src=\"/plex-logo.svg\" alt=\"Plex logo\"> <div class=\"transition-fix svelte-19df56k\" data-svelte-h=\"svelte-7sqg8o\"> </div> <div class=\"transition-outer svelte-19df56k\"><div class=\"transition-inner svelte-19df56k\"><div class=\"container svelte-19gkvlj\"><section class=\"grid svelte-8grxka\"><div class=\"titles svelte-8grxka\"><h1>Golden Fortress</h1> <h2><a href=\"/album/5d07cbdc403c640290e2ab2e\" class=\"svelte-vmm7cy\">Dandara</a> by\n\t\t\t<a href=\"/artist/5d07bfaa403c6402907820eb\" class=\"svelte-vmm7cy\">Thommaz Kauffmann</a></h2></div> <img class=\"art shadow svelte-8grxka\" src=\"https://images.plex.tv/photo?blur=0&amp;crop=center&amp;size=large-1280&amp;opacity=100&amp;url=https%3A%2F%2Flastfm.freetls.fastly.net%2Fi%2Fu%2F300x300%2Ff24fc3dff2ad496e03f8ec94383ff7de.jpg&amp;quality=80\" alt=\"Golden Fortress track art\"> </section>  <div class=\"loading svelte-1q0wp8b\"><a href=\"#loading\" style=\"\" class=\"svelte-mp20a2 skeleton\"><span class=\"svelte-mp20a2\"><img height=\"18\" width=\"18\" class=\"svg-icon loading svelte-mp20a2\" src=\"/logos/spotify.svg\" alt=\"logo for loading\"></span> loading </a> <a href=\"#loading\" style=\"\" class=\"svelte-mp20a2 skeleton\"><span class=\"svelte-mp20a2\"><img height=\"18\" width=\"18\" class=\"svg-icon loading 1234 svelte-mp20a2\" src=\"/logos/spotify.svg\" alt=\"logo for loading 1234\"></span> loading 1234 </a> <a href=\"#loading\" style=\"\" class=\"svelte-mp20a2 skeleton\"><span class=\"svelte-mp20a2\"><img height=\"18\" width=\"18\" class=\"svg-icon loading svelte-mp20a2\" src=\"/logos/spotify.svg\" alt=\"logo for loading\"></span> loading </a> <a href=\"#loading\" style=\"\" class=\"svelte-mp20a2 skeleton\"><span class=\"svelte-mp20a2\"><img height=\"18\" width=\"18\" class=\"svg-icon loading 56 svelte-mp20a2\" src=\"/logos/spotify.svg\" alt=\"logo for loading 56\"></span> loading 56 </a></div>   </div>  <div class=\"container svelte-19gkvlj\"><div></div> <div class=\"parent\"><h2 class=\"svelte-1qprkrs\" data-svelte-h=\"svelte-3bn9ry\">Tracks</h2> <a href=\"/track/5d0801f5403c640290ebbdec?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebbdec\"><div class=\"index svelte-1qprkrs\">1</div> <div class=\"main\">Dandara’s Purpose</div> <div class=\"duration svelte-1qprkrs\">03:14</div> </a><a href=\"/track/5d0801f5403c640290ebb3a0?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebb3a0\"><div class=\"index svelte-1qprkrs\">2</div> <div class=\"main\">Gap Between Two Worlds</div> <div class=\"duration svelte-1qprkrs\">00:40</div> </a><a href=\"/track/5d0801f5403c640290ebbc61?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebbc61\"><div class=\"index svelte-1qprkrs\">3</div> <div class=\"main\">A New Hope</div> <div class=\"duration svelte-1qprkrs\">04:50</div> </a><a href=\"/track/5d0801f5403c640290ebba9a?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebba9a\"><div class=\"index svelte-1qprkrs\">4</div> <div class=\"main\">Their Pleas Echoed Through Time</div> <div class=\"duration svelte-1qprkrs\">03:16</div> </a><a href=\"/track/5d0801f5403c640290ebb83d?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebb83d\"><div class=\"index svelte-1qprkrs\">5</div> <div class=\"main\">No More Singing Birds</div> <div class=\"duration svelte-1qprkrs\">04:33</div> </a><a href=\"/track/5d0801f4403c640290ebad0e?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f4403c640290ebad0e\"><div class=\"index svelte-1qprkrs\">6</div> <div class=\"main\">Once a Beautiful Horizon</div> <div class=\"duration svelte-1qprkrs\">07:21</div> </a><a href=\"/track/5d0801f4403c640290ebaddb?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f4403c640290ebaddb\"><div class=\"index svelte-1qprkrs\">7</div> <div class=\"main\">Remain in Oblivion</div> <div class=\"duration svelte-1qprkrs\">02:31</div> </a><a href=\"/track/5d0801f5403c640290ebb47a?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebb47a\"><div class=\"index svelte-1qprkrs\">8</div> <div class=\"main\">Weight of a Doubt</div> <div class=\"duration svelte-1qprkrs\">05:08</div> </a><a href=\"/track/5d0801f5403c640290ebb5ae?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebb5ae\"><div class=\"index svelte-1qprkrs\">9</div> <div class=\"main\">Mãe</div> <div class=\"duration svelte-1qprkrs\">05:47</div> </a><a href=\"/track/5d0801f4403c640290ebab92?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f4403c640290ebab92\"><div class=\"index svelte-1qprkrs\">10</div> <div class=\"main\">A Leap Towards Freedom</div> <div class=\"duration svelte-1qprkrs\">03:12</div> </a><a href=\"/track/5d0801f5403c640290ebb3c6?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebb3c6\"><div class=\"index svelte-1qprkrs\">11</div> <div class=\"main\">Crumbling Memories</div> <div class=\"duration svelte-1qprkrs\">07:23</div> </a><a href=\"/track/5d0801f5403c640290ebb217?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebb217\"><div class=\"index svelte-1qprkrs\">12</div> <div class=\"main\">Eternal Sigh</div> <div class=\"duration svelte-1qprkrs\">03:12</div> </a><a href=\"/track/5d0801f5403c640290ebb55e?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebb55e\"><div class=\"index svelte-1qprkrs\">13</div> <div class=\"main\">Lingering Question</div> <div class=\"duration svelte-1qprkrs\">01:45</div> </a><a href=\"/track/5d0801f5403c640290ebbb1a?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebbb1a\"><div class=\"index svelte-1qprkrs\">14</div> <div class=\"main\">Hidden in Logic</div> <div class=\"duration svelte-1qprkrs\">05:07</div> </a><a href=\"/track/5d0801f5403c640290ebb955?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebb955\"><div class=\"index svelte-1qprkrs\">15</div> <div class=\"main\">Hopefully a Nightmare</div> <div class=\"duration svelte-1qprkrs\">06:55</div> </a><a href=\"/track/5d0801f5403c640290ebb7e0?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebb7e0\"><div class=\"index svelte-1qprkrs\">16</div> <div class=\"main\">Golden Menace</div> <div class=\"duration svelte-1qprkrs\">04:05</div> </a><a href=\"/track/5d0801f5403c640290ebb73b?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs selected\" id=\"track-5d0801f5403c640290ebb73b\"><div class=\"index svelte-1qprkrs\">17</div> <div class=\"main\">Golden Fortress</div> <div class=\"duration svelte-1qprkrs\">05:58</div> </a><a href=\"/track/5d0801f5403c640290ebb7f2?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebb7f2\"><div class=\"index svelte-1qprkrs\">18</div> <div class=\"main\">The Relentless Choir</div> <div class=\"duration svelte-1qprkrs\">05:47</div> </a><a href=\"/track/5d0801f5403c640290ebb4b7?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebb4b7\"><div class=\"index svelte-1qprkrs\">19</div> <div class=\"main\">Stories of Freedom</div> <div class=\"duration svelte-1qprkrs\">00:43</div> </a><a href=\"/track/5d0801f5403c640290ebb2dc?parentGuid=5d07cbdc403c640290e2ab2e\" class=\"row svelte-1qprkrs\" id=\"track-5d0801f5403c640290ebb2dc\"><div class=\"index svelte-1qprkrs\">20</div> <div class=\"main\">Dandara’s Legacy</div> <div class=\"duration svelte-1qprkrs\">06:52</div> </a> </div> </div></div> </div></div> <div></div> <footer class=\"content svelte-97fxgh\" data-svelte-h=\"svelte-kououm\"><div class=\"svelte-97fxgh\"><span class=\"copyright svelte-97fxgh\">Copyright © 2022 Plex</span> <ul class=\"svelte-97fxgh\"><li class=\"svelte-97fxgh\"><a href=\"https://www.plex.tv/en-au/about/privacy-legal/\" class=\"svelte-97fxgh\">Privacy &amp; Legal</a></li> <li class=\"svelte-97fxgh\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://www.plex.tv/en-au/about/privacy-legal/#adchoices\" class=\"svelte-97fxgh\">AdChoices</a></li> <li class=\"svelte-97fxgh\"><a href=\"https://www.plex.tv/en-au/accessibility-statement/\" class=\"svelte-97fxgh\">Accessibility</a></li></ul></div></footer> </div> \n\t\t\t\n\t\t\t<script>\n\t\t\t\t{\n\t\t\t\t\tconst deferred = new Map();\n\n\t\t\t\t\t__sveltekit_hnzj3l = {\n\t\t\t\t\t\tbase: new URL(\"..\", location).pathname.slice(0, -1),\n\t\t\t\t\t\tenv: null,\n\t\t\t\t\t\tdefer: (id) => new Promise((fulfil, reject) => {\n\t\t\t\t\t\t\tdeferred.set(id, { fulfil, reject });\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tresolve: ({ id, data, error }) => {\n\t\t\t\t\t\t\tconst { fulfil, reject } = deferred.get(id);\n\t\t\t\t\t\t\tdeferred.delete(id);\n\n\t\t\t\t\t\t\tif (error) reject(error);\n\t\t\t\t\t\t\telse fulfil(data);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tconst element = document.currentScript.parentElement;\n\n\t\t\t\t\tconst data = [null,null,{\"type\":\"data\",\"data\":{response:{title:\"Golden Fortress\",guid:\"5d07cbdc403c640290e2ab2e\",mbid:\"83e39f9d-14b2-4a80-86bc-88769f6b59de\",art:{thumb:\"https://images.plex.tv/photo?blur=0&crop=center&size=large-1280&opacity=100&url=https%3A%2F%2Flastfm.freetls.fastly.net%2Fi%2Fu%2F300x300%2Ff24fc3dff2ad496e03f8ec94383ff7de.jpg&quality=80\",background:\"https://images.plex.tv/photo?blur=75&crop=center&size=medium-360&opacity=100&url=https%3A%2F%2Flastfm.freetls.fastly.net%2Fi%2Fu%2F300x300%2Ff24fc3dff2ad496e03f8ec94383ff7de.jpg&quality=30\"},summary:void 0,type:\"track\",country:void 0,style:void 0,links:[],children:[{index:1,title:\"Dandara’s Purpose\",guid:\"5d0801f5403c640290ebbdec\",type:\"track\",url:\"/track/5d0801f5403c640290ebbdec?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"03:14\"},{index:2,title:\"Gap Between Two Worlds\",guid:\"5d0801f5403c640290ebb3a0\",type:\"track\",url:\"/track/5d0801f5403c640290ebb3a0?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"00:40\"},{index:3,title:\"A New Hope\",guid:\"5d0801f5403c640290ebbc61\",type:\"track\",url:\"/track/5d0801f5403c640290ebbc61?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"04:50\"},{index:4,title:\"Their Pleas Echoed Through Time\",guid:\"5d0801f5403c640290ebba9a\",type:\"track\",url:\"/track/5d0801f5403c640290ebba9a?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"03:16\"},{index:5,title:\"No More Singing Birds\",guid:\"5d0801f5403c640290ebb83d\",type:\"track\",url:\"/track/5d0801f5403c640290ebb83d?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"04:33\"},{index:6,title:\"Once a Beautiful Horizon\",guid:\"5d0801f4403c640290ebad0e\",type:\"track\",url:\"/track/5d0801f4403c640290ebad0e?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"07:21\"},{index:7,title:\"Remain in Oblivion\",guid:\"5d0801f4403c640290ebaddb\",type:\"track\",url:\"/track/5d0801f4403c640290ebaddb?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"02:31\"},{index:8,title:\"Weight of a Doubt\",guid:\"5d0801f5403c640290ebb47a\",type:\"track\",url:\"/track/5d0801f5403c640290ebb47a?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"05:08\"},{index:9,title:\"Mãe\",guid:\"5d0801f5403c640290ebb5ae\",type:\"track\",url:\"/track/5d0801f5403c640290ebb5ae?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"05:47\"},{index:10,title:\"A Leap Towards Freedom\",guid:\"5d0801f4403c640290ebab92\",type:\"track\",url:\"/track/5d0801f4403c640290ebab92?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"03:12\"},{index:11,title:\"Crumbling Memories\",guid:\"5d0801f5403c640290ebb3c6\",type:\"track\",url:\"/track/5d0801f5403c640290ebb3c6?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"07:23\"},{index:12,title:\"Eternal Sigh\",guid:\"5d0801f5403c640290ebb217\",type:\"track\",url:\"/track/5d0801f5403c640290ebb217?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"03:12\"},{index:13,title:\"Lingering Question\",guid:\"5d0801f5403c640290ebb55e\",type:\"track\",url:\"/track/5d0801f5403c640290ebb55e?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"01:45\"},{index:14,title:\"Hidden in Logic\",guid:\"5d0801f5403c640290ebbb1a\",type:\"track\",url:\"/track/5d0801f5403c640290ebbb1a?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"05:07\"},{index:15,title:\"Hopefully a Nightmare\",guid:\"5d0801f5403c640290ebb955\",type:\"track\",url:\"/track/5d0801f5403c640290ebb955?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"06:55\"},{index:16,title:\"Golden Menace\",guid:\"5d0801f5403c640290ebb7e0\",type:\"track\",url:\"/track/5d0801f5403c640290ebb7e0?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"04:05\"},{index:17,title:\"Golden Fortress\",guid:\"5d0801f5403c640290ebb73b\",type:\"track\",url:\"/track/5d0801f5403c640290ebb73b?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"05:58\"},{index:18,title:\"The Relentless Choir\",guid:\"5d0801f5403c640290ebb7f2\",type:\"track\",url:\"/track/5d0801f5403c640290ebb7f2?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"05:47\"},{index:19,title:\"Stories of Freedom\",guid:\"5d0801f5403c640290ebb4b7\",type:\"track\",url:\"/track/5d0801f5403c640290ebb4b7?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"00:43\"},{index:20,title:\"Dandara’s Legacy\",guid:\"5d0801f5403c640290ebb2dc\",type:\"track\",url:\"/track/5d0801f5403c640290ebb2dc?parentGuid=5d07cbdc403c640290e2ab2e\",duration:\"06:52\"}],similar:void 0,parentGuid:\"5d07cbdc403c640290e2ab2e\",parentUrl:\"/album/5d07cbdc403c640290e2ab2e\",parentTitle:\"Dandara\",grandparentGuid:\"5d07bfaa403c6402907820eb\",grandparentTitle:\"Thommaz Kauffmann\",grandparentUrl:\"/artist/5d07bfaa403c6402907820eb\"},streamed:{links:__sveltekit_hnzj3l.defer(1)}},\"uses\":{\"search_params\":[\"parentGuid\",\"prime\"],\"params\":[\"type\",\"guid\",\"context\"]}}];\n\n\t\t\t\t\tPromise.all([\n\t\t\t\t\t\timport(\"../_app/immutable/entry/start.U_lEZRxr.js\"),\n\t\t\t\t\t\timport(\"../_app/immutable/entry/app.DO0XOe1z.js\")\n\t\t\t\t\t]).then(([kit, app]) => {\n\t\t\t\t\t\tkit.start(app, element, {\n\t\t\t\t\t\t\tnode_ids: [0, 2, 4],\n\t\t\t\t\t\t\tdata,\n\t\t\t\t\t\t\tform: null,\n\t\t\t\t\t\t\terror: null\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t</script>\n\t\t</div>\n\t</body>\n</html>\n\n<script>__sveltekit_hnzj3l.resolve({id:1,data:[{title:\"Bandcamp\",url:\"https://thommazk.bandcamp.com/album/dandara\",colour:\"#408ea3\",icon:\"bandcamp.svg\"}],error:void 0})</script>\n"

func TestParseBody(t *testing.T) {

	metadata, err := parseBody(testData)
	assert.Nil(t, err)
	assert.Len(t, metadata.Artists, 1)
	assert.Equal(t, "Thommaz Kauffmann", metadata.Artists[0])
	assert.Equal(t, "Golden Fortress", metadata.Title)
	assert.Equal(t, "Dandara", metadata.Album)
}
